<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI 每日精选</title>
  <!-- PWA -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#1a1710">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="AI精选">
  <link rel="apple-touch-icon" href="/icon-192.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked@9/marked.min.js"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            cream: { 50:'#faf7f0', 100:'#f3ede0', 200:'#e5dcc9', 300:'#d1c5ad', 400:'#b5a48a', 500:'#9a8870' },
            ink:   { 700:'#2e2b1e', 800:'#211f15', 900:'#161410', 950:'#0d0c08' },
            gold:  { 300:'#e0c070', 400:'#d4a850', 500:'#c09040', 600:'#a87830' },
          }
        }
      }
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/style.css">
</head>

<body class="bg-cream-100 text-ink-800 min-h-screen antialiased">

<!-- Reading progress bar -->
<div id="readingProgress"></div>

<!-- Back to top -->
<button id="backToTop" aria-label="回到顶部">
  <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" d="M5 15l7-7 7 7"/>
  </svg>
</button>

<!-- Toast container -->
<div id="toastContainer"></div>

<!-- ══ TRANSLATION MODAL ══════════════════════════════════════════ -->
<div id="translateModal" class="hidden fixed inset-0 z-50 flex items-start justify-center" style="background:rgba(20,18,12,0.72);backdrop-filter:blur(4px);overflow-y:auto;padding:32px 16px 48px;">
  <div class="translate-modal-box">
    <!-- Header -->
    <div class="tm-header">
      <div class="tm-meta">
        <span class="tm-badge">中文译文</span>
        <a id="tmOrigLink" href="#" target="_blank" rel="noopener" class="tm-orig-link">查看原文 ↗</a>
      </div>
      <div class="tm-actions">
        <button id="tmFontDec" class="tm-action-btn" title="缩小字号">A-</button>
        <button id="tmFontInc" class="tm-action-btn" title="放大字号">A+</button>
        <button id="tmRetranslate" class="tm-action-btn" title="重新翻译">↺</button>
        <button id="tmClose" class="tm-close" aria-label="关闭">✕</button>
      </div>
    </div>
    <!-- Loading state -->
    <div id="tmLoading" class="tm-loading">
      <div class="tm-spinner"></div>
      <p id="tmLoadingText" class="tm-loading-text">正在抓取原文并翻译，请稍候…</p>
    </div>
    <!-- Error state -->
    <div id="tmError" class="hidden tm-error">
      <p id="tmErrorMsg"></p>
      <a id="tmFallbackLink" href="#" target="_blank" rel="noopener" class="tm-fallback-btn">前往原文阅读 ↗</a>
    </div>
    <!-- Content -->
    <div id="tmContent" class="hidden">
      <h1 id="tmTitle" class="tm-title"></h1>
      <p id="tmSummary" class="tm-summary"></p>
      <div class="tm-divider"></div>
      <div id="tmBody" class="tm-body"></div>
    </div>
  </div>
</div>

<!-- ══ LOGIN ══════════════════════════════════════════════════════ -->
<div id="loginScreen" class="hidden fixed inset-0 z-50 bg-ink-900 flex items-center justify-center">
  <div class="text-center px-8 w-full max-w-xs">
    <div class="login-badge">DAILY INTELLIGENCE</div>
    <h1 class="login-title">AI 精选</h1>
    <p class="login-sub">全球 AI 行业精选</p>
    <div class="space-y-3">
      <input id="loginPassword" type="password" placeholder="访问密码"
        class="login-input" autocomplete="current-password">
      <button id="loginBtn" class="login-btn">进入</button>
      <p id="loginError" class="hidden text-xs text-red-400 pt-1"></p>
    </div>
  </div>
</div>

<!-- ══ MAIN APP ═══════════════════════════════════════════════════ -->
<div id="mainApp" class="hidden">

  <!-- ────────────────────────────────────────────────────────────
       DARK HERO HEADER
  ──────────────────────────────────────────────────────────────── -->
  <header class="site-hero">
    <div class="hero-inner">

      <div class="hero-badge-row">
        <span class="hero-badge">DAILY INTELLIGENCE</span>
      </div>

      <h1 class="hero-title">AI 精选</h1>
      <p class="hero-tagline">全球 AI 行业精选</p>
      <p class="hero-date" id="heroDate"></p>

      <div class="hero-rule"></div>

      <div class="hero-toolbar">
        <div class="hero-icons">
          <button id="shareBtn"    class="h-ico-btn" title="分享当日日报">
            <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4 12v8a2 2 0 002 2h12a2 2 0 002-2v-8M16 6l-4-4-4 4M12 2v13"/></svg>
          </button>
          <button id="themeToggle" class="h-ico-btn" title="切换主题">
            <svg id="sunIcon"  class="hidden dark:block" width="14" height="14" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/><path stroke-linecap="round" d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
            <svg id="moonIcon" class="block dark:hidden"  width="14" height="14" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
          </button>
          <button id="settingsBtn" class="h-ico-btn" title="设置">
            <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path stroke-linecap="round" d="M12.22 2h-.44a2 2 0 00-2 2v.18a2 2 0 01-1 1.73l-.43.25a2 2 0 01-2 0l-.15-.08a2 2 0 00-2.73.73l-.22.38a2 2 0 00.73 2.73l.15.1a2 2 0 011 1.72v.51a2 2 0 01-1 1.74l-.15.09a2 2 0 00-.73 2.73l.22.38a2 2 0 002.73.73l.15-.08a2 2 0 012 0l.43.25a2 2 0 011 1.73V20a2 2 0 002 2h.44a2 2 0 002-2v-.18a2 2 0 011-1.73l.43-.25a2 2 0 012 0l.15.08a2 2 0 002.73-.73l.22-.39a2 2 0 00-.73-2.73l-.15-.08a2 2 0 01-1-1.74v-.5a2 2 0 011-1.74l.15-.09a2 2 0 00.73-2.73l-.22-.38a2 2 0 00-2.73-.73l-.15.08a2 2 0 01-2 0l-.43-.25a2 2 0 01-1-1.73V4a2 2 0 00-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
          </button>
        </div>
        <button id="generateBtn" class="h-gen-btn">✦ 生成日报</button>
      </div>

      <div class="hero-date-sel-wrap">
        <select id="dateSelect" class="hero-date-sel"></select>
      </div>

    </div>
  </header>

  <!-- ─────────────────────��──────────────────────────────────────
       CONTENT AREA
  ──────────────────────────────────────────────────────────────── -->
  <main class="page-body">

    <!-- Skeleton loading view -->
    <div id="skeletonView" class="hidden flex flex-col">
      <!-- skel panel 1 -->
      <div class="skel-section">
        <div class="panel">
          <div class="panel-header"><div class="skel-line w-6 h-3 rounded"></div><div class="skel-line w-24 h-3 rounded ml-2"></div></div>
          <div class="p-7 bg-[#1e1b12]">
            <div class="skel-line-dark w-36 h-2 rounded mb-5"></div>
            <div class="space-y-3"><div class="skel-line-dark w-full h-3 rounded"></div><div class="skel-line-dark w-full h-3 rounded"></div><div class="skel-line-dark w-4/5 h-3 rounded"></div><div class="skel-line-dark w-3/4 h-3 rounded"></div></div>
          </div>
        </div>
      </div>
      <!-- skel panel 2 -->
      <div class="skel-section">
        <div class="panel">
          <div class="panel-header"><div class="skel-line w-6 h-3 rounded"></div><div class="skel-line w-20 h-3 rounded ml-2"></div></div>
          <div class="p-4 grid grid-cols-4 gap-2">
            <div class="skel-line h-16 rounded-xl"></div><div class="skel-line h-16 rounded-xl"></div><div class="skel-line h-16 rounded-xl"></div><div class="skel-line h-16 rounded-xl"></div>
          </div>
        </div>
      </div>
      <!-- skel panel 3 -->
      <div class="skel-section">
        <div class="panel">
          <div class="panel-header"><div class="skel-line w-6 h-3 rounded"></div><div class="skel-line w-20 h-3 rounded ml-2"></div></div>
          <div class="grid grid-cols-3 divide-x divide-[#ede4d0]">
            <div class="p-5 space-y-3"><div class="skel-line h-3 w-3/4 rounded"></div><div class="skel-line h-3 w-full rounded"></div><div class="skel-line h-3 w-2/3 rounded"></div></div>
            <div class="p-5 space-y-3"><div class="skel-line h-3 w-3/4 rounded"></div><div class="skel-line h-3 w-full rounded"></div><div class="skel-line h-3 w-2/3 rounded"></div></div>
            <div class="p-5 space-y-3"><div class="skel-line h-3 w-3/4 rounded"></div><div class="skel-line h-3 w-full rounded"></div><div class="skel-line h-3 w-2/3 rounded"></div></div>
          </div>
        </div>
      </div>
      <!-- skel panel 4 -->
      <div class="skel-section">
        <div class="panel">
          <div class="panel-header"><div class="skel-line w-6 h-3 rounded"></div><div class="skel-line w-20 h-3 rounded ml-2"></div></div>
          <div class="divide-y divide-[#ede4d0]">
            <div class="p-5 space-y-2"><div class="skel-line h-3 w-1/4 rounded"></div><div class="skel-line h-4 w-3/4 rounded mt-2"></div><div class="skel-line h-3 w-full rounded"></div><div class="skel-line h-3 w-5/6 rounded"></div></div>
            <div class="p-5 space-y-2"><div class="skel-line h-3 w-1/4 rounded"></div><div class="skel-line h-4 w-2/3 rounded mt-2"></div><div class="skel-line h-3 w-full rounded"></div><div class="skel-line h-3 w-4/5 rounded"></div></div>
            <div class="p-5 space-y-2"><div class="skel-line h-3 w-1/4 rounded"></div><div class="skel-line h-4 w-3/4 rounded mt-2"></div><div class="skel-line h-3 w-full rounded"></div><div class="skel-line h-3 w-3/4 rounded"></div></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Status banner -->
    <div id="statusBanner" class="hidden mb-4">
      <div class="status-card">
        <div class="status-spinner"></div>
        <span id="statusText" class="text-xs text-gold-500"></span>
      </div>
    </div>

    <!-- Empty state -->
    <div id="emptyState" class="hidden">
      <div class="panel text-center py-20">
        <div class="empty-diamond">◇</div>
        <p class="text-sm font-light text-cream-400 mt-4 mb-1">尚无日报内容</p>
        <p class="text-xs text-cream-300">在设置中配置 API Key，然后点击「生成日报」</p>
      </div>
    </div>

    <!-- ── PANEL 1 : 今日日报 ─────────────────────────────────── -->
    <section id="highlightsSection" class="hidden">
      <div class="panel">
        <div class="panel-header">
          <span class="panel-num">01</span>
          <span class="panel-title">今日日报</span>
        </div>

        <!-- Dark featured block -->
        <div class="feat-card">
          <div class="feat-label">
            ENHANCED EDITION<span class="feat-dot">·</span>增强版
          </div>
          <p id="highlightsText" class="feat-body"></p>
          <div id="statsSection" class="hidden feat-stats">
            <div class="fstat"><div class="fstat-sq"></div><span id="statSources" class="fstat-n">—</span><span class="fstat-l">条来源</span></div>
            <div class="fstat"><div class="fstat-sq"></div><span id="statTotal"   class="fstat-n">—</span><span class="fstat-l">篇抓取</span></div>
            <div class="fstat"><div class="fstat-sq"></div><span id="statFiltered" class="fstat-n">—</span><span class="fstat-l">篇过滤</span></div>
            <div class="fstat gold"><div class="fstat-sq-g"></div><span id="statSelected" class="fstat-n">—</span><span class="fstat-l">篇精选</span></div>
          </div>
          <div class="feat-foot">
            <span id="digestDate" class="feat-date"></span>
          </div>
        </div>

      </div>
    </section>

    <!-- ── PANEL 2 : 内容分类 ─────────────────────────────────── -->
    <section id="filterSection" class="hidden">
      <div class="panel">
        <div class="panel-header">
          <span class="panel-num">02</span>
          <span class="panel-title">内容分类</span>
        </div>

        <div class="cat-grid">
          <button class="cat-btn active" data-cat="all">
            <span class="cat-ic">◈</span><span class="cat-nm">全部</span>
          </button>
          <button class="cat-btn" data-cat="ai-ml">
            <span class="cat-ic">⬡</span><span class="cat-nm">AI / ML</span>
          </button>
          <button class="cat-btn" data-cat="security">
            <span class="cat-ic">◉</span><span class="cat-nm">安全</span>
          </button>
          <button class="cat-btn" data-cat="engineering">
            <span class="cat-ic">◫</span><span class="cat-nm">工程</span>
          </button>
          <button class="cat-btn" data-cat="tools">
            <span class="cat-ic">◧</span><span class="cat-nm">工具</span>
          </button>
          <button class="cat-btn" data-cat="opinion">
            <span class="cat-ic">◈</span><span class="cat-nm">观点</span>
          </button>
          <button class="cat-btn" data-cat="other">
            <span class="cat-ic">◌</span><span class="cat-nm">其他</span>
          </button>
        </div>

        <div class="panel-search">
          <svg class="search-ico" width="13" height="13" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path stroke-linecap="round" d="M21 21l-4.35-4.35"/></svg>
          <input id="searchInput" type="text" placeholder="搜索文章、关键词、来源…" class="search-input">
        </div>
      </div>
    </section>

    <!-- ── PANEL 3 : 今日必读 ─────────────────────────────────── -->
    <section id="top3Section" class="hidden">
      <div class="panel">
        <div class="panel-header">
          <span class="panel-num">03</span>
          <span class="panel-title">今日必读</span>
          <span class="panel-header-badge">TOP 3</span>
        </div>
        <div id="top3Grid" class="top3-grid"></div>
      </div>
    </section>

    <!-- divider -->
    <div id="divider" class="hidden panel-divider"></div>

    <!-- ── PANEL 4 : 全部精选 ─────────────────────────────────── -->
    <section id="articleSection" class="hidden">
      <div class="panel">
        <div class="panel-header">
          <span class="panel-num">04</span>
          <span class="panel-title">全部精选</span>
        </div>
        <div id="articleList" class="space-y-3"></div>
      </div>
    </section>

  </main>

  <!-- DARK FOOTER ──────────────────────────────────────────────── -->
  <footer class="site-footer">
    <div class="footer-inner">
      <div class="footer-rule"></div>
      <div class="footer-gem">✦</div>
      <h2 class="footer-title">AI 精选</h2>
      <p class="footer-sub">全球 AI 行业精选</p>
      <p class="footer-meta">每日自动更新 · 增强版深度内容</p>
      <div class="footer-nav">
        <span>行业新闻</span><span class="footer-dot">·</span>
        <span>AI / ML</span><span class="footer-dot">·</span>
        <span>工具推荐</span><span class="footer-dot">·</span>
        <span>观点分析</span>
      </div>
    </div>
  </footer>

</div><!-- /mainApp -->

<!-- ══ SETTINGS MODAL ═══════════════════════════════════════════ -->
<div id="settingsModal" class="modal-bg hidden">
  <div class="modal-box">
    <div class="drag-pill sm:hidden"></div>
    <h3 class="modal-heading">⚙ &nbsp;设置</h3>

    <div class="flex border-b border-cream-200 mb-5">
      <button id="tabApi" class="settings-tab active" data-tab="api">API 配置</button>
      <button id="tabRss" class="settings-tab"        data-tab="rss">RSS 源</button>
    </div>

    <div id="apiTab" class="settings-tab-content space-y-5">
      <div>
        <label class="s-lbl">API 渠道</label>
        <div id="presetBtns" class="grid grid-cols-3 gap-2">
          <button class="preset-btn" data-preset="gemini"><span class="text-xs font-medium">Google Gemini</span><span class="text-[9px] text-cream-400 mt-0.5">gemini-2.0-flash</span></button>
          <button class="preset-btn" data-preset="doubao"><span class="text-xs font-medium">豆包 Doubao</span><span class="text-[9px] text-cream-400 mt-0.5">doubao-seed</span></button>
          <button class="preset-btn" data-preset="custom"><span class="text-xs font-medium">自定义</span><span class="text-[9px] text-cream-400 mt-0.5">OpenAI 兼容</span></button>
        </div>
      </div>
      <div>
        <label class="s-lbl">API Key</label>
        <div class="flex gap-2">
          <input id="cfgApiKey" type="password" placeholder="输入 API Key" class="s-inp flex-1">
          <button id="testApiBtn" class="test-btn shrink-0">测试</button>
        </div>
        <p id="cfgApiKeyHint" class="text-[10px] text-cream-400 mt-1.5"></p>
        <p id="testResult" class="hidden text-[10px] mt-1.5"></p>
      </div>
      <div id="customFields" class="hidden space-y-3">
        <div><label class="s-lbl">Base URL</label><input id="cfgBaseURL" type="text" placeholder="https://api.openai.com/v1" class="s-inp"></div>
        <div><label class="s-lbl">模型</label><input id="cfgModel" type="text" placeholder="gpt-4o-mini" class="s-inp"></div>
      </div>
      <div class="border-t border-cream-200 pt-5">
        <div class="flex items-center justify-between mb-3">
          <label class="text-xs font-medium">每日自动生成</label>
          <label class="relative inline-flex items-center cursor-pointer">
            <input id="cfgScheduleEnabled" type="checkbox" class="sr-only peer">
            <div class="w-[34px] h-[18px] bg-cream-300 peer-checked:bg-gold-500 rounded-full transition-colors after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-[14px] after:w-[14px] after:transition-all peer-checked:after:translate-x-[14px]"></div>
          </label>
        </div>
        <div id="scheduleFields" class="hidden space-y-3">
          <div class="grid grid-cols-3 gap-2">
            <div><label class="text-[10px] text-cream-400 block mb-1">几点生成</label><input id="cfgScheduleHour" type="number" min="0" max="23" value="8" class="s-inp text-center"></div>
            <div><label class="text-[10px] text-cream-400 block mb-1">时间范围</label><select id="cfgScheduleHours" class="s-inp"><option value="24">24h</option><option value="48" selected>48h</option><option value="72">72h</option></select></div>
            <div><label class="text-[10px] text-cream-400 block mb-1">精选数量</label><select id="cfgScheduleTopN" class="s-inp"><option value="10">10</option><option value="15" selected>15</option><option value="20">20</option></select></div>
          </div>
        </div>
      </div>
      <p id="cfgStatus" class="hidden text-xs text-center pt-1"></p>
    </div>

    <div id="rssTab" class="settings-tab-content hidden space-y-4">
      <p class="text-xs text-cream-500 leading-relaxed">管理 RSS 订阅源。默认使用 90 个精选源，可添加自定义源。</p>
      <div class="flex gap-2">
        <input id="rssName" type="text" placeholder="源名称" class="s-inp flex-1 min-w-0">
        <input id="rssUrl"  type="text" placeholder="RSS URL"  class="s-inp flex-1 min-w-0">
        <button id="testRssBtn" class="test-btn shrink-0">测试</button>
        <button id="addRssBtn" class="text-xs px-3 py-2 rounded-lg bg-gold-500/10 text-gold-600 hover:bg-gold-500/20 transition shrink-0">添加</button>
      </div>
      <p id="rssTestResult" class="hidden text-[10px]"></p>
      <div class="border border-cream-200 rounded-xl overflow-hidden max-h-52 overflow-y-auto">
        <div id="rssList" class="divide-y divide-cream-100"></div>
      </div>
      <button id="resetRssBtn" class="w-full text-xs py-2 rounded-lg border border-cream-200 text-cream-400 hover:bg-cream-50 transition">恢复默认源</button>
    </div>

    <div class="flex gap-2 mt-6 pt-5 border-t border-cream-100">
      <button id="settingsCancel" class="m-btn-sec">取消</button>
      <button id="settingsSave"   class="m-btn-pri">保存配置</button>
    </div>
  </div>
</div>

<!-- ══ GENERATE MODAL ════════════════════════════════════════════ -->
<div id="generateModal" class="modal-bg hidden">
  <div class="modal-box">
    <div class="drag-pill sm:hidden"></div>
    <h3 class="modal-heading">✦ &nbsp;生成日报</h3>
    <p id="genConfigInfo" class="text-xs text-cream-400 mb-5 leading-relaxed"></p>
    <div class="grid grid-cols-2 gap-3 mb-6">
      <div><label class="s-lbl">时间范围</label><select id="genHours" class="s-inp"><option value="24">24 小时</option><option value="48" selected>48 小时</option><option value="72">72 小时</option><option value="168">7 天</option></select></div>
      <div><label class="s-lbl">精选数量</label><select id="genTopN" class="s-inp"><option value="10">10 篇</option><option value="15" selected>15 篇</option><option value="20">20 篇</option></select></div>
    </div>
    <div class="flex gap-2">
      <button id="genCancel"  class="m-btn-sec">取消</button>
      <button id="genConfirm" class="m-btn-pri">开始生成</button>
    </div>
  </div>
</div>

<script>
(function(){
  const d=new Date(), days=['日','一','二','三','四','五','六'];
  const el=document.getElementById('heroDate');
  if(el) el.textContent=`${d.getFullYear()}年${String(d.getMonth()+1).padStart(2,'0')}月${String(d.getDate()).padStart(2,'0')}日 · 星期${days[d.getDay()]}`;
})();
</script>
<script src="/enhancements.js"></script>
<script src="/app.js"></script>
</body>
</html>
